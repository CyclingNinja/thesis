% !TeX root = ../thesis.tex
%*****************************************************************************************
%*********************************** Fifth Chapter ***************************************
%*****************************************************************************************



\chapter{A detailed case study of a jet-like feature at the limb}
\label{ch:5}
\begin{pycode}[chapter5]
ch5 = texfigure.Manager(pytex, number=4, base_path='./Chapter5/')
\end{pycode}

\section{Introduction}
Solar jets of various forms are ubiquitous throughout the solar atmosphere, from spicules and MSs low in the chromosphere, both of which pass through the transition region, to coronal and X-Ray jets extending into the solar corona \cite{Archontis2008,Majarska2011,Morton2012}. 
Investigations into these phenomena have advanced significantly with recent developments in solar telescope technology, applied on missions like Hinode and the Solar Dynamics Observatory (SDO) and the most recent mission Interface Region Imaging Spectrometer (IRIS).
Features are observed in a range of wavelengths and heights in the atmosphere \cite{Wang1998,Yamaucho2004}. 

Low in the chromosphere the predominant feature is the spicule, these small scale jets are generally found forming over inter-granular lanes and reaching heights of $1$ - $5$ Mm.
They are also very short lived, lifetimes generally only reaching ~$10$ mins.
More importantly there is currently debate as to whether the population of spicules is divided into two forms, Type-1 and Type-2. 
Type-1 are described as longer lived and less explosive with respect to velocity, whereas Type-2 reach higher velocities and higher into the atmosphere, however, are not observed to fall back into the chromosphere \cite{DePontieu2007,Beckers1972,Sterling2000}. 

Having stated this, \cite{Pereira2014} have revealed that Type-2 spicules disappearance may be as a result of heating and moving out of the passband, due to the fact that they are consequently observed in a hotter line which may imply that these features are not in fact separate populations and \cite{Zhang2012} finds no such distinction in population.

Many formation mechanisms have been proposed for spicules, including reconnection, \emph{p}-mode driving and applying accretion disk models in a solar context, for reviews see \cite{Sterling2000} and \cite{Zaqara_Erdelyi2009}.
More recently, the question surrounding spicules is how they effect the atmosphere is particularly pertinent given their vast number. 
Any contribution in terms of solar wind acceleration or heat transfer would be scaled up by their sheer number density.
\cite{Rouppe2015} used coordinated observations with SST and IRIS to study RRE's and RBE's, examining H$\alpha$, Mg II h \& k, C II and Si IV.
The authors find that these spicule-like extensions observed in H$\alpha$ have counter parts in the hotter Magnesium lines and the upper chromosphere/transition region C II and Si IV, which would certainly imply that these features are heating themselves, or the atmosphere around them.
These spicules are similar to other features such as surges, the already mentioned RRB's/RBE's and chromospheric jets, all of which need considering with respect to spicules \cite{Tsiropoula2012, Kuridze2015}.


Higher in the chromosphere, MSs are generated, despite their origin laying low in the chromosphere, MSs extend through to the transition region and into the corona. 
Larger counterparts of spicules, initially observed in $1975$ by \cite{Bohlin1975} using the Skylab 2 mission using a He $30.4$ nm filter viewing the upper chromopshere.
Bohlin stated their lifetimes to be $5$ to $30$ mins and lengths to be approximately $10$ - $50$ arcsec, and these values have been confirmed \cref{ch:3}

Macrospicules are generally accepted as multi-thermal structures, featuring a cool core and a hot sheath resulting from formation in the cooler atmosphere, from being observed in H$\alpha$ \citep{LaBonte79} and hotter high chromosphere lines such as in \cite{Parenti2002}.
They have also been observed to rotate, \cite{Pike_Mason1998} and \cite{Kamio2010}, the latter paper quotes $-120 \pm 15$kms$^{-1}$ blue shift Doppler velocity on the left side of the macrospicule. 

There are multiple proposals for the mechanism triggering apparent rotation of the macrospicule. 
\cite{Curdt2011} propose that the Sun's differential rotation causes MSs rotation, whereas, reconnection events cause the relaxation of a small-scale twisted loop, as demonstrated by \cite{Adams2014}.
Again, with MSs extending high into the atmosphere, the question of their effect upon it, is one that needs answering.
\cite{Pike1997} observe outflows from the macrospicule of the order $200$ kms$^{-1}$ in He I and discuss whether these outflows could potentially accelerate the solar wind.
However, work by \cite{Zaqarashvili2014} questions whether jets moving at super-Alfv{\'e}nic speeds might cause a Kelvin-Helmholtz instability to form at the macrospicule/atmosphere boundary, which would, in turn, transport heat into the corona.

A third category of jet-like features, are coronal jets, observed in slightly hotter lines of $17.1$ nm but still visible in EUV, such as those discussed in \cite{Shibata1992} and simulated in \cite{Wyper2016}.
\cite{Shibata1994} propose that these jets are reconnection events, where reconnection is triggered by flux emergence at the base of a small-scale loop.
However, after this initial reconnection, there are several models as to how the system evolves.
\cite{Moore2010} demonstrate a dichotomy in formation mechanism of coronal jets, between the standard 'inverted Y' model by Shibata and the blow-out jet model. 
The blow-out model differs from the standard model due the reconnection leading to a 'curtain' of plasma flow as opposed to the 'spire' from the standard model.
The difference between the two models originates in initial configuration of the overlying arch. 
In standard jets the arch has no appreciable shear, whereas for a blowout jet the arch is twisted and sheared sufficiently to drive the explosive outflow which forms the jet.
Coronal jets have also been shown to accelerate particles into interplanetary space \cite{Li2011} and there is also evidence for repeat onset jets, with several re-occurrences, \cite{Chifor2008} demonstrate repeat on set of jets driven by flux cancellation.

Lastly, we need to consider X-ray jets.
\cite{Shimojo2000} define their physical properties studying 16 separate jet events.
Due to limitations on instrumentation at the time, the authors do not cover the extent of the jets, however, they analyse temperatures, $3 - 8$ MK, and density, $0.4 - 4.0$ cm$^{-9}$.
The authors also discuss flaring at the foot-point of X-ray jets, in that, the temperature is proportional to the size of the initial footpoints.

\cite{Kamio2010} applied a great deal of the background above when studying a macrospicule and X-ray jet forming simultaneously. There is also discussion in \cite{Pike1997} and \cite{Kim2007} on the appearance of X-ray jets, alongside small scale jets.

In the following sections we comprehensively discuss the physical properties of a case study. In \cref{sec:obs_sect} we present the observations we are using. \ref{sec:time_dist_sect} discusses the evolution of the jet with respect to its extent an the different view of the feature utilising STEREO-A's EUVI. Then move on to a doppler analysis of the jet in \cref{sec:dop_shift_sect}. Lastly, attempt to quantify the effect of the jet on the atmosphere in \cref{sec:temp_map_sect} before making our conclusions.

\begin{pycode}[chapter5]
import numpy as np
import sunpy.map
import matplotlib.pyplot as plt
from mpl_toolkits.axes_grid1 import ImageGrid

onset_path_113 = ch5.data_file('crop_113.npy')
onset_path_114 = ch5.data_file('crop_114.npy')
onset_path_115 = ch5.data_file('crop_115.npy')

ims = [np.load(onset_path_113), np.load(onset_path_114), np.load(onset_path_115)]


multi = texfigure.MultiFigure(1, 3, reference="onset")

for i, anim in enumerate(ims):
    fig = plt.figure(figsize=texfigure.figsize(pytex, scale=0.3, height_ratio=1.3))

    plt.imshow(anim, cmap='sdoaia304', origin='lower')

    Fig1 = ch5.save_figure('onset{}'.format(i+1), fig)
    Fig1.subfig_width = r"0.3\textwidth"
    Fig1.caption = ""
    multi.append(Fig1)

multi.placement = 't!'
multi.caption = "a) Observe the two bright points in the proximity of $(79, 60)$. The point on the left is significantly brighter than the fainter on the right. We emphasise that the brightening around $(60, 50)$ is not a contributor to this jet. b) In this frame the bright points have extended, the fainter point has now extended up to $~95$ and the core of the brighter left feature has grown with it. c) At this point the two separate points are now indistinguishable and the feature is now extending as one column."
\end{pycode}

\py[chapter5]|multi|



\section{Observations}
\label{sec:obs_sect}
We observed a jet-like (hereby referred to as 'the jet') feature at the limb on $21$st June 2016 beginning at $07:30:00$ in CRISP, an instrument installed on the Swedish Solar Telescope (SST) during a period of good seeing, \cite{Scharmer2003}.
We used the H$\alpha$ filter, core line $656.28$ nm with $35$ slit increments from the core covering a $.32$ nm range, $-0.2$ and $+0.12$, further processed using te Multi-Object Multi-Frame Blind Deconvolution (MOMBFD \cite{vanNoort2005}).
The observations were of Active Region 11506 with $xc = 893",\ yc = -250"$ in heliographic coordinates on $930x930$ pixel images, with spatial resolution of $0.012$ arcsec/pixel and temporal resolution of $7.5$ sec.
Due to the constant surveillance under which we have the Sun, we also have simultaneous observations with the Solar Dynamic Observatory (SDO) and the Solar Terrestrial Relations Observatory (STEREO).

Using the Atmospheric Imaging Assembly (AIA), we observe the jet in most of the wavelengths available, $30.4$, $35.5$, $211$, $17.1$ and $13.1$ nm.
AIA on-board SDO (\cite{AIAspec}) provides $4096 \times 4096$ pixel images with a spatial resolution of $0.6$ arcsec per pixel and a cadence of $12$ sec.

Lastly, we also have observations in STEREO using the Extreme Ultra Violet Imager (EUVI) \cite{Defise2001}. 
We are fortunate that when these observations were taken, STEREO A was at approximately $90^\circ$ to the Sun-Earth line, as such we also have observations of this feature as an on-disk feature.
In this case we are using the $30.4$ nm HI instrument, however, the distance from the Earth has now reached a point that the temporal cadence has reduced to $10$ min.
While this is possibly too high to undertake a detailed examination, we can certainly utilise this method to inform us as to the global behaviour of the macrospicule.
As we have a suite of observing instruments to utilise we aim to build a comprehensive description of this feature and how it may affect the environment around it.


\section{Time-Distance Evolution}
\label{sec:time_dist_sect}

Let us begin with the evolution of the jet over time. 
We have utilised a self-built, manual, feature measuring tool, which uses a clicking mechanism to select the foot and tip of the macrospicule, calculates the half height and uses this as a guide to measure the width of the feature.
Using this tool on each frame, and therefore the time cadence of the instrument, we obtain the evolution of the jet and general ballistic information.
We have used this tool on each wavelength to examine the extent upwards through the corona. 
Observations in SDO record the entire lifetime of the feature, however the same is not true for observations using the SST, where the observation window in SST closes at $07:55:00$.

\subsection{Onset}
The jet feature is observed as it forms using SST and, fortunately, we can resolve initial stages of the jet formation.
The jet is observed to initiate in the core of H$\alpha$ with two small bright points forming, and an ensuing jet developing above it. 
\cref{fig:onset} captures the early evolution of the jet in detail.
Evident in \cref{fig:onset1} we find the initial two bright points at the foot of the jet, the bright point of the left being significantly brighter than its countpart on the right.
By \cref{fig:onset2} shows the development of these two points \emph{i.e.} have now become two columns of brighter plasma.
In the final formation stage, \cref{fig:onset3} the jet has formed and is now a distinct feature against the background.
This behaviour is in keeping with the standard jet formation model demonstrated by \cite{Shibata1992}, where the authors describe an 'inverted y' shape of brightened material that is a result of small scale flux emergence reconnection.



\subsection{Evolution}
Let us examine the raw evolution of the jet in the time distance plot in \cref{fig:t-d-plot}.
Here we have utilised the measuring tool to measure the extent of the feature in all the wavelengths in which it is visible.
We find that the overall profile of its evolution contains two distinct peaks in most wavelengths, with the exception of $17.1$ nm.
The first peak comes at $~07:37$ before a decrease in size and subsequent secondary expansion to its maximum length in H$\alpha$ and $30.4$ nm at approximately $07:49$.
This strongly implies that there is a second initialising type event in which a new material is accelerated into the atmosphere.
As such let us turn to the CRISP instrument again.

With its higher resolution, a slit based analysis of the jet can be observed in \cref{fig:sst-slit}.
Notice two distinct curves in the image, the first onset is at approximately $17$ and the second at a bright point originating at $~85$.
We find that in this second phase of the jet, plasma extends higher into the atmosphere.
This result is unusual as previous observations of recurrent jets have shown decay in subsequent initialisation events in observations such as \cite{Jiang2007}.
Unfortunately, a section of material is in front of the base of the jet and obscures our view of the second event.

Considering the observations in multiple wavelengths, we notice the smaller extension visible in the coronal wavelengths.
In these higher temperature lines, the jet appears as a dark line.
Now, this could be due to the fact that the feature is cool and can't be found in the higher temperatures.
However, when examining the jet in AIA $30.4$ nm, the feature appears dark beneath the limb but emissive over it.
It also appears in EUVI $30.4$ m, as a dark feature, therefore we can't assume there is no emission in the higher lines.
This is not unexpected, given its extent in the chromospheric lines, we can to categorise this as a chromospheric feature, as opposed to coronal.

%double check this section
Evidently, the maximum extent of this feature is in SDO $30.4$ and maximises at $12.6$ Mm although the measurements in H$\alpha$ may exceed this were it to be fully visible.
Interestingly, the length of the jet in the coronal lines does not get larger after the second injection on plasma occurs.
This subsequent acceleration of plasma originates from the same location as that of the initial formation, and on the same scale as the first onset.
However, this drives the tip of the jet even higher than the initial tip, measuring the velocity accurately is difficult, due to this acceleration is set against the previous bright material.
An approximation using multiple image steps and using a difference delta produces an average of $46$ kms${^{-1}}$, therefore we can infer that it reaches a higher maximum velocity than the first ejection.

The feature is very thin, averaging $1.13$ Mm in H$\alpha$ and $0.787$ Mm in He II. 
This result is unexpected, it certainly seems to contradict the cool core surrounded by a hot sheath model.
However the errors on the measurement in SDO/AIA recordings are $\pm1.5$ Mm, when taking into account human measurement error and resolution of the instrument.
Where as measurement error on the CRISP/SST images is $\pm0.0885$ Mm, thus, we are more inclined to believe the measurement according to CRISP.
This thin spire is an expected outcome of the standard model of jet formation, more on which later.

\begin{pycode}[chapter5]
import pickle
import def_spic
import def_spic_SST
from matplotlib.dates import DateFormatter

path_131 = ch5.data_file('131_records.pik')
path_171 = ch5.data_file('171_records.pik')
path_211 = ch5.data_file('211_records.pik')
path_304 = ch5.data_file('304_records.pik')
path_335 = ch5.data_file('335_records.pik')
ha_path = ch5.data_file('H_alpha_records.pik')

jet_131 = pickle.load(open(path_131, 'r'))
jet_171 = pickle.load(open(path_171, 'r'))
jet_211 = pickle.load(open(path_211, 'r'))
jet_304 = pickle.load(open(path_304, 'r'))
jet_335 = pickle.load(open(path_335, 'r'))
h_alpha = pickle.load(open(ha_path, 'r'))
obj_131 = jet_131[0]
obj_171 = jet_171[0]
obj_211 = jet_211[0]
obj_304 = jet_304[0]
obj_335 = jet_335[0]
obj_Ha = h_alpha[0]

e_times_131 = obj_131.times
lengths_131 = obj_131.all_length()

e_times_171 = obj_171.times
lengths_171 = obj_171.all_length()

e_times_211 = obj_211.times
lengths_211 = obj_211.all_length()

e_times_304 = obj_304.times
lengths_304 = obj_304.all_length()

e_times_335 = obj_335.times
lengths_335 = obj_335.all_length()

e_times_Ha = obj_Ha.times
lengths_Ha = obj_Ha.all_length()

fig = plt.figure()
plt.plot(e_times_131, lengths_131, color='green', label='13.1 nm')
plt.plot(e_times_171, lengths_171, color='yellow', label='17.1 nm')
plt.plot(e_times_211, lengths_211, color='purple', label='21.1 nm')
plt.plot(e_times_304, lengths_304, color='orange', label='30.4 nm')
plt.plot(e_times_335, lengths_335, color='blue', label='33.5 nm')
plt.plot(e_times_Ha, lengths_Ha, color='darkgoldenrod', label='656.28 nm')
plt.xlabel('Time [UCT]')
plt.ylabel('Length [Mm]')
plt.title('Length of the Jet over time')
fig.autofmt_xdate()

formatter = DateFormatter('%H:%M:%S')
plt.gcf().axes[0].xaxis.set_major_formatter(formatter)

td_fig = ch5.save_figure('t-d-plot', fig)
td_fig.subfig_width = r"\columnwidth"
td_fig.caption = ""
#td_fig.caption = r"Darkgold = H$\alpha$, Blue = 33.5 nm, Orange = 30.4 nm, Purple = 21.1 nm, Yellow = 17.1 nm, Green = 13.1 nm. The CRISP observations end earlier than thewhole evolution of the jet, and the top of the jet is cut off by the top og the image. Therefore we ignore the flatline at the top of the H$\alpha$ line starting at $07:42$"
\end{pycode}

\begin{figure}[H]
	\centering
	\py[chapter5]|td_fig.repr_subfigure()|
	
	\begin{subtable}[b]{\textwidth}
		\centering
		\begin{tabular}{ccc}
		Wavelength, nm & Maximum Length, Mm & Maximum Velocity km/s \\
		656.2 & 11.3 & 0.09 \\
		30.4 & 12.6 & 31.5 \\
		33.5 & 6.0 & 53.6 \\
		21.1 & 5.5 & 50.1 \\
		17.1 & 5.6 & 51.9 \\
		13.1 & 5.6 & 36.6 \\
		\end{tabular}
		\caption{}
	\end{subtable}
	\caption{a) Darkgold = H$\alpha$, Blue = 33.5 nm, Orange = 30.4 nm, Purple = 21.1 nm, Yellow = 17.1 nm, Green = 13.1 nm. The CRISP observations end earlier than the whole evolution of the jet, and the top of the jet is cut off by the top of the image. Therefore we ignore flatline at the top of the H$\alpha$ line starting at 07:42. b) Table of maximised basic spatial properties of the jet.}
\end{figure}


\begin{pycode}[chapter5]
import numpy as np
import sunpy.cm
import matplotlib.pyplot as plt
from astropy.visualization.mpl_normalize import ImageNormalize 
from astropy import visualization

norm=ImageNormalize(stretch=visualization.AsinhStretch(1))

sst_slit_path = ch5.data_file('2016-01-22 14:59:58.507931.npz')

afile = np.load(sst_slit_path)
data = afile['arr_2']

fig = plt.figure(figsize=texfigure.figsize(pytex))
plt.imshow(np.rot90(data[2])[::-1, 100:], cmap='viridis', aspect='auto', origin='lower', norm=norm)
plt.colorbar()
plt.xlabel('Time in SST cadence (7.7 s)')
plt.ylabel('Distance along the slit')
sst_slit_fig = ch5.save_figure('sst-slit', fig)
sst_slit_fig.figure_env_name = r'figure*'
sst_slit_fig.figure_width = r'\columnwidth'
sst_slit_fig.placement = 'H'
sst_slit_fig.caption = r'CRISP/SST H$\alpha$ core line slit analysis.'

#print(sst_slit_fig.repr_figure(), file=sys.stderr)
\end{pycode}

\py[chapter5]|sst_slit_fig|



\subsection{STEREO-A}
We are fortunate that we can observe the jet feature in the STEREO-A/EUVI, with the position of the spacecraft at approximately $90^\circ$ to the Sun-Earth line.
This facilitates the building of a larger picture of the behaviour of the jet, the downside to this however, is that with STEREO-A being at such a distance the cadence is low, $~10$ mins.
In this case we obtain 4 images in $30.4$ nm in which the jet is observed.
The jet appears as a dark fibril like feature originating at ***A POINT IN SPACE*** and extending across the disk to a length of $45.1$arcsec.
Significantly, the component of extension in the East-West direction is not insignificant, approximately $30$ arcsec.
With this information we calculate that the total length of the feature, taking into account both SDO and STEREO's view, is $25.5$ Mm.



\begin{pycode}[chapter5]
import numpy as np
import sunpy.map
import matplotlib.pyplot as plt
import astropy.units as u
from glob import glob
from mpl_toolkits.axes_grid1 import ImageGrid

path_stereo_1 = ch5.data_file('20120621_072615_n4eua.fts')
path_stereo_2 = ch5.data_file('20120621_073615_n4eua.fts')
path_stereo_3 = ch5.data_file('20120621_074615_n4eua.fts')
path_stereo_4 = ch5.data_file('20120621_075615_n4eua.fts')

stereos = [path_stereo_1, path_stereo_2, path_stereo_3, path_stereo_4]


multi_ST = texfigure.MultiFigure(2, 2, reference="stereo")


for i, im in enumerate(stereos):
	fig = plt.figure(figsize=texfigure.figsize(pytex, scale=0.5, height_ratio=0.8))
	
	amap = sunpy.map.Map(im)
	crop = amap.submap([-640, -510]*u.arcsec, [-430, -330]*u.arcsec)
	crop.plot(title=False)
	ax = plt.gca()
	ax.coords[0].set_ticks(number=3)
	plt.tight_layout(pad=3)
	Fig1 = ch5.save_figure('stereo{}'.format(i+1), fig)
	Fig1.subfig_width = r"0.49\textwidth"
	Fig1.caption = ""
	multi_ST.append(Fig1)

multi_ST.placement = 't'
multi_ST.caption = "EUVI $30.4$ nm images from STEREO on $21$st June at a) $07:26:15$, b) $07:36:15$, c) $07:46:15$ and d) $07:56:15$. "
\end{pycode}

\py[chapter5]|multi_ST|



\section{Doppler shift}
\label{sec:dop_shift_sect}

Possibly the most valuable information to be gained about the development of jets, is pertaining to it rotational behaviour, therefore, we will use the spectral increments from the CRISP instrument to obtain line-of-sight Doppler velocities.
There is, however, a hindrance with this.
There are two seperate forms of the emmission spectra within the image.
The region where the jet initialises, is on disk, and as a result the spectral analysis reveals an absorption spectra.

\subsection{MCMC Method}

We have developed this algorithm to address this particular problem, using the overall shift of the emission line from the standard emission. 
Over the limb, however, the spectral profile changes to emission and we find two peaks.
As a consequence of this, finding the total shift away from the core, $656.28$ nm, is made more complex.
For pixel points which are on-disk, we fit a single Gaussian and calculate the minima, as is standard, and for the two peak spectra, we have utilised a double Gaussian, finding the minima between the two.
However, the problem becomes evident when we need to change between the two routines.

We have utilised a Markov Chain Monte Carlo (MCMC) (\cite{Richey2010}) method to find the most accurate fit and the Bayesian Information Criterion (BIC) to test which of the two fits is most appropriate from a given line as a solution to this problem.

This method takes the 35 spectral intensity for a given pixel and samples multiple possible fits for the profile these produce.
We then find the most likely fit from this range and minimise this final fit to find the mean value of the fit.
Difference between the original core value and mean of the new fit is the calculated shift in wavelength, and therefore, the line-of-sight velocity for the chromospheric plasma.
The process is the same for both single and double Gaussian fitting and as such we apply a BIC to test which fit is more appropriate.
BIC has limitations when the number of parameters is of the same order of the size of the sample and differentiating between multiple complex models.
In this case the sample is larger than the number of parameters and we are only testing two possible models, as such, we can use the test with confidence in the results.

The result of applying the above method to the CRISP/SST spectroscopic dataset is presented in \cref{fig:dop-exam}.
Immediately apparent, is the banding structured red and blue shifts, the effect is created as a result of the optical depth created when observing at the limb. 
The jet forms in amongst a blue band of smaller thin structures, making early observations in the dopplergrams difficult.  

\subsection{Analysis}
This particular feature, as has already been mentioned, has two events in which material is accelerated upwards into the solar atmosphere.
The first event is not readily visible in the dopplergrams, difficult as it is to pick out against a line of spicule-like features all showing blueshifts, towards the viewewing direction.
This result is to be expected given the we have demonstrated movement away from the 'camera' in \cref{fig:stereo}.
Whereas, the second expulsion of material, originating at $07:37$, exhibits the classic behaviour of a rotating feature in dopplergrams, a red/blue split over the body of the feature. 
 
It is clear that the second event comes from a similarly small element to the first and evolves upwards, joining the full formation of the jet, hence why the apparent rotation of the jet does not appear to spread across the rest of the jet as seen in H$\alpha$.

As the jet evolves we see an initial blue shift, matching the acceleration upwards seen in H$\alpha$, and it is only after a few second seconds of evolution that rotational behaviour begins to become evident.
The first panel in \cref{fig:dop-exam} at $07:37:44$ demonstrates the first panel where there might be in inkling of redshift on the right ride of the feature, with a thin line registering as moving away from the camera.
Noticeably, this rotation does not begin at the base of the feature, instead, the rotation manifests from the tip downwards over the next two images at $07:37:51$ and $07:37:59$.

By the time the jet reaches $07:39:07$, we begin to observe a thin formation of red shift at the right side of the base of the feature, and by $07:38:15$, the red-shift has entirely taken over the right hand side.
Though once again, the next frame shows progression up the spire of the feature.

We subsequently observe the sift to disappear from the right hand side of the jet, however, the subsequent two images show an element of red shift now on the left of the feature.
This element consequently develops into longer feature in $07:38:53$ and subsequent images, to the point where red shift now dominates the left hand side of the feature.

This is a result of the magnetic pressure acting as restoring force, and rotating the feature in the opposite direction. 
However in this case, not to the same magnitude, an expected outcome due to inherent loss of energy from the system.
By the last panel at $07:39:16$, the feature has returned to a 'neutral' state, as such we can estimate an approximate period of a minute and a half.

This behaviour is extremely interesting as it demonstrates a torsional motion of the entire body of the feature, with the structure rotating anti-clockwise and then clockwise.
This is a result of the release of magnetic tension in the initial reconnection event causing an unwinding of the inherent twist in the initial loop.
We suggest that, as a result of the speed of the initial acceleration of the plasma material, this untwisting began at the top of the plasma column as is seen in $07:37:51$.
The peak of this untwisting, when the red shift dominates the RHS at $07:38:15$, with the highest velocity values observed at approximately $3-4$ kms${^{-1}}$ and the 'body' of the feature demonstrating velocities in the range $1.0-1.5$ kms${^{-1}}$.

The velocity values given here are slow compared to those presented in previous works, however, we believe these to be accurate, and attribute this to the smalls scale of the initial loop.
A larger scale loop would mean that the magnetic tension would be greater, and hence, experience greater restoring force, inducing higher velocities.

  




\begin{pycode}[chapter5]
import sunpy
import slit

import matplotlib as mpl
import matplotlib.pyplot as plt
from matplotlib import colors
from mpl_toolkits.axes_grid1 import ImageGrid
from matplotlib import gridspec
from matplotlib.collections import LineCollection

import numpy as np
import numpy.ma as ma

import astropy.units as u
import datetime
from datetime import timedelta
from astropy.constants import c
from sunkitsst.read_cubes import read_cubes
from glob import glob

# some funcitons
def get_time(ind, time_0):
    current_time = time_0 + timedelta(seconds=7.7)*ind
    return current_time

def truncate_colormap(cmap, minval=0.0, maxval=1.0, n=100):
    new_cmap = colors.LinearSegmentedColormap.from_list(
        'trunc({n},{a:.2f},{b:.2f})'.format(n=cmap.name, a=minval, b=maxval),
        cmap(np.linspace(minval, maxval, n)))
    return new_cmap


#dop_frames = [76,77,78,79,80,81,82,83,85]
dop_frames = [76,77,78,79,80,81,82,83,85,86,87,88,89]
frame_numbers = np.arange(75,90)

# read in some datas
dop_files = []
for i in frame_numbers:
    dop_files.append(ch5.data_file('dops/dop_arr_test0{}.npy'.format(i)))
dop_files.sort()

t0_ha = datetime.datetime(2012,6,21,7,15,9)
t0_dop = get_time(100, t0_ha)

dops = np.zeros((len(dop_files), 331, 120))
for i, afile in enumerate(dop_files):
    dops[i] = np.load(afile)

# process the the dops to get vels
l0 = 6562.8*u.Angstrom
dops = dops*u.Angstrom
dops = (l0-dops)/l0*c
dops = dops.to(u.km/u.s)

# get the variables for the slit analysis
# lets use a perfectly horizontal slit
x1 = 45
x2 = 65
y1 = y2 = 130
N = 0


### make the graph for time and slit
slit_inds = slit.slit_count(x1, y1, x2, y2, 0, 0, N)

# index the arrays properly
inds_x = np.array([slit_inds[:,:,0]])
inds_y = np.array([slit_inds[:,:,1]])
ind_dop = dops[:,inds_y, inds_x]

dop_fin = ind_dop[:,0]

# get the dopplergrams associated with the rotation
slit_list = []
for i, n in enumerate(frame_numbers):
    temp = dop_fin[i]
    temp[temp > 20*dop_fin.unit] = np.NaN
    slit_list.append(temp)

xy_slit = [np.array(zip(range(len(slit_inds[0])), s[0].value)) for s in slit_list]


n_cmap = truncate_colormap(plt.get_cmap('Oranges'), 0.3, 1.0)


# new figure using subplot2grid specificially
fig = plt.figure(figsize=texfigure.figsize(pytex, height_ratio=1.5))
gs = gridspec.GridSpec(3,8)
ax1 = plt.subplot(gs[0,0:2])
ax2 = plt.subplot(gs[0,2:4])
ax3 = plt.subplot(gs[0,4:6])
ax4 = plt.subplot(gs[0,6:8])
ax5 = plt.subplot(gs[1,0:2])
ax6 = plt.subplot(gs[1,2:4])
ax7 = plt.subplot(gs[1,4:6])
ax8 = plt.subplot(gs[1,6:8])
ax9 = plt.subplot(gs[2,0:2])
ax10 = plt.subplot(gs[2,2:4])
ax11 = plt.subplot(gs[2,4:6])
ax12 = plt.subplot(gs[2,6:8])
 
ax_list = [ax1, ax2, ax3, ax4, ax5, ax6,
           ax7, ax8, ax9, ax10, ax11, ax12]

for n, an_ax in zip(dop_frames, ax_list):
    i = np.where(frame_numbers == n)[0][0]
    time_dop = get_time(n, t0_dop).strftime('%H:%M:%S')
    temp_dop = dops[i].value
    y_shift = 40
    im = an_ax.imshow(temp_dop[:250,40:], vmax=15, vmin=-15,
                      cmap='RdBu_r', origin='lower',
                      norm=mpl.colors.SymLogNorm(1),
                      interpolation='none')
    an_ax.plot([x1, x2], [y2-y_shift,y2-y_shift], color='k')
    an_ax.set_title('{}'.format(time_dop), fontsize=10)
    an_ax.set_xlim(left=1, right=80)
    an_ax.set_ylim(bottom=1, top=225)
    an_ax.locator_params(axis='x', nbins=4)
    im.cmap.set_under('w')
    im.cmap.set_over('w')

cb = fig.colorbar(im, ax=ax12, pad=0.1, fraction=0.111)
cb.set_label('Velocity {}'.format(dop_fin.unit._repr_latex_()))
cb.set_ticks([-15,-9,-6,-3,-2,-1,0,1,2,3,6,9,15])

# line collection section
n_cmap = truncate_colormap(plt.get_cmap('Oranges'), 0.3, 1.0)

# fig, ax = plt.subplots()
line_segments = LineCollection(xy_slit,
                               linewidths = 0.5,
                               linestyle='solid',
                               cmap=n_cmap)

line_segments.set_array(np.arange(1,len(slit_list)+1))
#ax10.add_collection(line_segments)
#ax10.axis([1,xy_slit[0].shape[0]-1,-1.6,1.6])
#ax10.axhline(0, color='k', linewidth=0.5)

#axcb = fig.colorbar(line_segments)
#axcb.set_label('Frame Number')
#axcb.set_ticks(range(1, len(xy_slit)+1))
#ax10.set_title('Slit across')
#ax10.set_xlabel('Distance Along Slit [pixels]')
#ax10.set_ylabel('Velocity {}'.format(dop_fin.unit._repr_latex_()))
#plt.sci(line_segments)

gs.tight_layout(fig, w_pad=0.9, h_pad=0.5)

dop_grid = ch5.save_figure('dop-exam', fig)
dop_grid.figure_width = r'\textwidth'
dop_grid.placement = 'H'
dop_grid.caption = 'Above is the result of the dopplergram processing during the evolution of the second ejection of plasma starting at $07:37:00$. All images shown in pixel coordinates.'


\end{pycode}

\py[chapter5]|dop_grid|





\section{Effect on the atmosphere}
\label{sec:temp_map_sect}

With the increased resolution we can visually inspect the boundary between the jet and atmosphere.
\cref{fig:demo-bound} details the evolution of the jet in the core of H$\alpha$ in over $115$ seconds.
At the boundary we observe narrow dark columns in the emission on either side of the jet.
Given that they appear on either side of the jet column and that the observations are in the core of the $H\alpha$ line, it is unlikely that this would be caused by a doppler-like effect.
One possibility is that the cause is an instability effect, such as shear or Kelvin-Helmholtz, seen in \cite{Zaqarashvili2014} as the jet moves throughout the higher atmosphere.
Supporting this hypothesis is that these images were recorded in the 'second phase' of the jet \emph{i.e.} after the second reconnection and the jet extends to its peak in $30.4$ nm. 
As such, it is possible that these columns are a result of plasma being accelerated through the less dense atmosphere.

One of the possible primary results of these instabilities is a dissipation of energy into the surrounding atmosphere, as such we might expect an increase in temperature of the surrounding atmosphere.
To this end we will utilise the temperature calculation method highlighted in \cite{Leonard2014}.

The authors use a Differential Emission Measure (DEM) to obtain a temperature response from the SDO/AIA measurements.
The temperature response is a combination of the wavelength response from the instrument and the contribution function which describes the emission from a given temperature.
When using such a scheme, we need to decide on a general DEM profile to be applied to all pixels.
The method uses a Gaussian scan across the emission in each line and property of the Gaussian; mean, amplitude and width. 
Utilising a narrow Gaussian seems to provide the most accurate values when compared to synthetic observations.

\cref{fig:temp-slit} demonstrates the behavioural change of the temperature across the normal of the feature by slit based analysis.
By performing this analysis over the time domain of the second ejection of plasma material, we will acertain whether the feature has any impact on the atmosphere.
The difficulty with this form if measurement is that the feature itself is not particularly wide, $~1$ Mm, and therefore is has only one or two pixels of actual jet material for us to examine.
The jet is located around the $3rd$ and $4th$ pixels of the x axis, and as we would expect we see a moderate dip, when compared to the surroundings. 
Noticeable as well, however, is that at what is approximately the boundaries, there is a peak in temperature, before it drops as distance increases with respect to the jet.

These values are not conclusive, we require temperature maps on a much finer spatial scale, and as well, new techniques to develop to overcome the problems of the extremely broad H$\alpha$ and He II lines causing a blurring of possible values.
However, in conjunction with the observations presented here of possible shearing or Kelvin Helmholtz instability causing a lack of emission at the boundary of the jet, we can present the hypothesis more confidently.
In terms of the bigger picture in which spicules/jets/MSs contribute to heating of the solar corona, the results produced by this feature are not typical.
With respect to other studies, this feature cannot be considered that quick, or large, or excessively rotational, yet it may be having a measurable effect.
Hence, applying this kind of comprehensive analysis to multiple jets, particularly rapidly evolving examples, to ascertain their impact on the atmosphere fully is the next area of investigation for these jets.
An endeavour which will be aided significantly by the operation commencement of DKIST, with its superior everything.
 


\begin{pycode}[chapter5]
import numpy as np
from glob import glob
import sunpy.map
import matplotlib.pyplot as plt

im_1 = ch5.data_file('core_Ha_dark_165.npy')
im_2 = ch5.data_file('core_Ha_dark_170.npy')
im_3 = ch5.data_file('core_Ha_dark_175.npy')
im_4 = ch5.data_file('core_Ha_dark_180.npy')

ims = [im_1, im_2, im_3, im_4]

multi_db = texfigure.MultiFigure(1, 4, reference="demo-bound")
multi_db.caption = "Sequence of images detailing an intermediate phase of the jets evolution. Beggining with a) 07:36:19, b) 07:36:19, c) 07:37:36 and d) 07:38:15"
for i, im in enumerate(ims):
	fig = plt.figure(figsize=texfigure.figsize(pytex, scale=0.25, height_ratio=1.3))
	ax = plt.gca()
	ax.tick_params(axis='both', colors='white', labelcolor='black')
	afile = np.load(im)
	val_max = np.max(afile)
	plt.imshow(afile, cmap='Greys_r', vmin=0.16*val_max, vmax=val_max, origin='lower', interpolation='none')
	Fig1 = ch5.save_figure('demo_bound{}'.format(i+1), fig)
	Fig1.subfig_width = r"0.2\textwidth"
	Fig1.caption = ""
	multi_db.append(Fig1)

\end{pycode}

\begin{pycode}[chapter5]
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.collections import LineCollection
from matplotlib import colors

import sunpy.map
import slit

from astropy.io import fits
import astropy.units as u

from glob import glob

files = glob('/storage2/temperature_maps/data/full_gauss/*.fits')
files.sort()

def proc_file(x):
    with fits.open(x, memmap=True) as f:
        data = f[0].data[..., 0]
        header = dict(f[0].header)
        m = sunpy.map.Map((data, header))
        m.plotsettings = {'cmap':'coolwarm'}
        crop = m.submap((857.9, 957.94)*u.arcsec,
                 (-197.92, -297.92)*u.arcsec)
    return crop 


submaps = []
for afile in files[28:40]:
    temp = proc_file(afile)
    submaps.append(temp)

mc = sunpy.map.Map(submaps, cube=True)


image_1 = slit.slit(mc, [909, 911]*u.arcsec, [-245, -242]*u.arcsec, 1, -1, +1)

temp_values = image_1[0]
temp_inds = image_1[1]


xy_slit = [np.array(zip(range(len(temp_inds)), temp_values[0,:,i])) for i in range(temp_values.shape[2])]

def truncate_colormap(cmap, minval=0.0, maxval=1.0, n=100):
    new_cmap = colors.LinearSegmentedColormap.from_list(
        'trunc({n},{a:.2f},{b:.2f})'.format(n=cmap.name, a=minval, b=maxval),
        cmap(np.linspace(minval, maxval, n)))
    return new_cmap

nmap = truncate_colormap(plt.get_cmap('Oranges'), 0.3, 1.0)

line_segments = LineCollection(xy_slit,
                               linewidths=0.25,
                               linestyle='solid',
                               cmap=nmap)

line_segments.set_array(np.arange(len(temp_values[0,0,:])))

fig, ax = plt.subplots(figsize=texfigure.figsize(pytex))


ax.add_collection(line_segments)
ax_cb = fig.colorbar(line_segments)
ax_cb.set_label('Time')
ax.axis([0,5 , 6.4, 6.6])
ax.set_title('Temperature over slit')
ax.set_xlabel('Distance across slit')
ax.set_ylabel('Temperature')
plt.sci(line_segments)
plt.draw()

temp_slit = ch5.save_figure('temp-slit', fig)
temp_slit.caption = "The AIA maps were processed into temperature maps, and a slit was taken at the half height, perpendicular to the axis of evolution. The temperature maps were taken for the time over which the second acceleration of material occured. The colorbar indicates the passage of time and the various lines applicable to the slits is demonstrated."


\end{pycode}

\py[chapter5]|multi_db|

\py[chapter5]|temp_slit|

\section{Discussion \& Conclusion}
\label{sec:DandC}

We observe a jet-like feature at the solar limb on $21$st June 2012 at $07:30:00$ on the solar limb, centred at $910$, $234$ solar x and y.
We have multiple methods with which to view the feature, CRISPT/SST, the range of AIA/SDO coronal wavelengths and SECCHI/STEREO-A.
We have utilised multiple analysis techniques to build a comprehensive picture of the jet-like features motion and the possible impacts on the atmosphere above it.

From the observation of this feature, we can draw the following conclusions
\begin{itemize}
	\item{This particular feature is visible in H$\alpha$ and He II $30.4$, and thus, is inherently a chromospheric object.}
	\item{The jet has two separate ejections of material. Reaching a maximum \emph{length} of $25$ Mm}
	\item{The formation of the jet is observed to be similar to the standard jet formation mechanism.}
	\item{The jet has a rotational component to its motion}
\end{itemize}

The feature is observed to extend to $12.6$ Mm in He II $30.4$ nm (and is only found to be shorter in H$\alpha$ due to moving out of the viewing field of view).
Its lifetime is measured of to be $20$ mins and radial velocities are found to be maximised during the initial acceleration, and are of the order $50 - 60$ km$s^{-1}$ during the first acceleration of the feature.
However the second acceleration of material proves awkward to measure accurately, however we estimate slightly higher maximum velocities, but similar averages over the extension upwards. 
This very much puts this feature in the category of MSs, agreeing with the values presented in \cref{ch:3}.

However the feature exhibits similar formation mechanisms as a standard jet following the pattern demonstrated in \cite{Shibata1992} and then built on by \cite{Moore2010}, who also presented the blowout jet mechanism.
With the two visible bright points in the H$\alpha$ images which come to form an, all be it, long thin bright arch before forming the characteristic spire of a the standard jet.
Unfortunatley, Hinode's XRT instrument was in a power down mode during the formation of this feature and RHESSI did not record the event, as such, we are missing crucial X-ray data.

If an increase in the X-ray radiation were to be found, the question as to the categorisation of such a feature becomes important.
Given that we observe several of the key indicators of a standard jet, could this not also be classified as a standard jet? 
Inspite of this features relatively small size, this could be classified as an X-ray jet.
However the question remains, is this a macrospicule?
And if so, do we classify the feature as a macrospicule or a standard jet?

One possible differentiator is the appearance in the higher coronal wavelengths.
In this case, the jet appears as an absorption feature, against the brighter limb.
This does not mean that the jet does not reach coronal temperatures, in $30.4$ nm the jet appears as absorption below the limb and as emission above it.
We cannot conclusively say that the jet contributes to the coronal emission by visual inspection.

Therefore, we propose that this is a standard jet, and as a community, we need to fully address the underlying physics of MSs.
This is despite the ambiguity about its appearance in the coronal emission lines, but the underlying physics is enough to draw this conclusion.

The spectroscopic readings, as show in \cref{dop_shift_sect}, demonstrates a small, but appreciable perturbation in the rotational velocity of the jet like feature.
We find that the jet exhibits a torsional behaviour, demonstrating shifts indicating rotation in one direction and then the other.
The magnitude of these velocities is, however, low.
we conclude that this is a result of the very small source loop of the feature, although this of course needs further enquiry. 

With respect to the features affect on the atmosphere, we find a boundary interaction between the jet and atmosphere in the H$\alpha$ images.
This interaction has manifested as dark streaks at the every edges of the feature during the same phase in which the second event causes the acceleration of further plasma.
It is also the phase in which we observe the torsional rotation of the jet.
Whether these dark streaks are physically significant we cannot comment upon too confidently at this time, but they appear at the same time as the second acceleration and the onset of rotational behaviour, cannot merely be coincidence.
